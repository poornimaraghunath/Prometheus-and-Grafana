# Prometheus-and-Grafana

# Why monitoring is required ?
     Because to monitor the large number kubernetes cluster in this prometheus is used for monitoring the clusters and grafana is used for better visualization.

# Prometheus architecture   

    In prometheus the main components is prometheus server which has three components in it

      * Retrieval - Pulls data metrics from applications or services
      * TSDB  (Timeseries data base) -It stores the data of the metrics
      * Http : It is used for acceptimg queries from the promql or grafana and provide the data

      Metrics entries are of # type and #help attributes 
      where #help : provides the description
            #type : in type there are 3 types
               1 counter : It defines how many times X happened(eg how many time the request came)
               2 gauge : what is the current value of X now(what is the cpu usuage ,memory usage)  
               3 Histogram : It defines how long it took for that event to happen

      # how does prometheus collects data from the targets
          It is collected through endpoint metrics from retrival some applications has already created the prometheus endpoints (eg kubernetes)

     # for few applications endpoints are not available for such applications we need to use to exporters to collect the metrics from them which fetches the metrics and convert them to correct format and expose metrics         
# link for prometheus exporter
 https://prometheus.io/docs/instrumenting/exporters/

 # Link for prometheus client librariers this used to monitor our own applications by using the libraries and exposing the endpoints 
 https://prometheus.io/docs/instrumenting/clientlibs/

 # Prometheus works on pull mechanism only for short lived applications push mechanism is used
  +------------------------+      +------------------------+
  |                        |      |                        |
  |     Monitored Targets |      |       Alertmanager     |
  |   (Applications,      |      |  (Handles alerts and   |
  |    Services, Servers) |<---->|   sends notifications)  |
  |                        |      |                        |
  +-----------+------------+      +------------+-----------+
              |                                |
              | HTTP Requests (metrics)        | Alerts
              |                                |
              v                                v
  +-----------+-----------+      +------------+------------+
  |                       |      |                         |
  |   Prometheus Server   |<---->|     Grafana            |
  | (Scrapes and stores   |      | (Visualization and     |
  |   metrics, executes   |      |  dashboarding tool)    |
  |   PromQL queries)     |      |                         |
  |                       |      |                         |
  +-----------------------+      +-------------------------+

   
   it is prometheus server in which it has components like 

   # Http server - which is make an api request to the kubernetes api server to collect the metrics
   # TSDB - which is used to store the time when the metrics was collected.
   # Node - which is storgae it as HDD or ssd

   Monitored Targets:

These are the systems or applications that Prometheus monitors. They expose metrics via HTTP endpoints in a format Prometheus understands.
#Prometheus Server:Responsible for scraping and storing metrics data from the monitored targets. It periodically pulls metrics data from targets, stores them in its time-series database, and executes PromQL queries against the stored data for visualization and alerting.

#Alertmanager:Receives alerts generated by Prometheus based on predefined alerting rules. It handles alert grouping, deduplication, and notification routing to various integrations such as email, PagerDuty, Slack, etc.

#Grafana:Grafana is a separate component often used alongside Prometheus for visualization and dashboarding. It connects to Prometheus as a data source, allowing users to create rich, interactive dashboards to visualize metrics data collected by Prometheus.

#HTTP Requests (metrics):Prometheus retrieves metrics data from monitored targets by making HTTP requests to their designated endpoints. These endpoints expose metrics in a format understood by Prometheus, typically in a simple text-based format like Prometheus exposition format.

#Alerts:Alerts are generated by Prometheus based on predefined alerting rules. When certain conditions are met (e.g., threshold exceeded), Prometheus triggers alerts which are then forwarded to Alertmanager for further processing and notifications.

# what is Grafana ?

Grafana is a popular open-source data visualization and analytics platform that allows you to create custom dashboards and visualizations based on a variety of data sources. Grafana is often used for monitoring and analyzing metrics and logs in real-time, making it an ideal tool for monitoring systems and applications, including Kubernetes environments.

Grafana supports a wide range of data sources, including databases, time-series databases, and other data storage systems. It provides a powerful query language that allows you to retrieve and analyze data from these sources, and to create custom dashboards and alerts based on that data.

In addition to its powerful data visualization and analysis capabilities, Grafana is also highly extensible. It supports a wide range of plugins and integrations, including integrations with popular monitoring and logging tools like Prometheus, Elasticsearch, and InfluxDB.

# Helm is used to install prometheus
   prometheus can be installed using helm chart

# How to install helm on linux machine
curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
cat get_helm.sh
chmod +x get_helm.sh
./get_helm.sh
helm version #check helm version

# Add helm repo
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts

# Update helm repo
helm repo update

# Install helm
helm install prometheus prometheus-community/prometheus




